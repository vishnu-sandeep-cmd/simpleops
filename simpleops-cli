#!/usr/bin/env python3
# simpleops-cli

import sys
from simpleops.parser import parse_command
from simpleops.executor import execute
from simpleops.config import load_config

def main():
    print("🚀 Welcome to SimpleOps! Type 'help', 'exit', or a command")

    try:
        cfg = load_config()
    except Exception as e:
        print("❌", str(e))
        print("🔧 You may need to:")
        print("  1. Run: aws configure --profile simpleops-dev")
        print("  2. Create ~/.simpleops/config.yaml")
        return

    while True:
        try:
            cmd = input("SimpleOps> ").strip()
            if cmd in ['exit', 'quit']:
                print("👋 Goodbye!")
                break
            if cmd == 'help':
                print("""
📝 Available Commands:
  create in aws: s3: mybucket: 1      # Create S3 bucket
  get all ec2_ip addresses            # Get public IPs
  set env: dev                        # Switch env
                """)
                continue
            if not cmd:
                continue

            parsed = parse_command(cmd)
            result = execute(parsed, cfg)
            if "error" in result:
                print("❌", result["error"])
            else:
                print("✅", result)

        except KeyboardInterrupt:
            print("\n👋 Exiting...")
            break
        except Exception as e:
            print("💥 Error:", str(e))

if __name__ == "__main__":
    main()
