#!/usr/bin/env python3
# simpleops-cli

import sys
from simpleops.parser import parse_command
from simpleops.executor import execute
from simpleops.config import load_config

def main():
    print("ğŸš€ Welcome to SimpleOps! Type 'help', 'exit', or a command")

    try:
        cfg = load_config()
    except Exception as e:
        print("âŒ", str(e))
        print("ğŸ”§ You may need to:")
        print("  1. Run: aws configure --profile simpleops-dev")
        print("  2. Create ~/.simpleops/config.yaml")
        return

    while True:
        try:
            cmd = input("SimpleOps> ").strip()
            if cmd in ['exit', 'quit']:
                print("ğŸ‘‹ Goodbye!")
                break
            if cmd == 'help':
                print("""
ğŸ“ Available Commands:
  create in aws: s3: mybucket: 1      # Create S3 bucket
  get all ec2_ip addresses            # Get public IPs
  set env: dev                        # Switch env
                """)
                continue
            if not cmd:
                continue

            parsed = parse_command(cmd)
            result = execute(parsed, cfg)
            if "error" in result:
                print("âŒ", result["error"])
            else:
                print("âœ…", result)

        except KeyboardInterrupt:
            print("\nğŸ‘‹ Exiting...")
            break
        except Exception as e:
            print("ğŸ’¥ Error:", str(e))

if __name__ == "__main__":
    main()
